%%GENERATED_WARNING%%

if: tag IS blank

language: generic

services:
  - docker

branches:
  only:
    - master

env:
  global:
    - DOCKER_USERNAME: garypendergast
    - GITHUB_USERNAME: desrosj
    # DOCKER_PASSWORD
    - secure: XM3hZ+2t+v5tZ2mX5vEc/keczuTRCu2dTWhxclkMquEUkjNJiIjFEBGd5eYFdYoXiz/+eW8f7nPJy4MFO5k9tHUfBWPv2+eLZEU8FxjAFE2rEJ2nlN2IABuaiKAOZKBWmL7EV5G+BHxJqhinNLK+sOP74WrqIlTngidIRC4Xaf8Mhqt8BH2UiryBPoMJcYEO9pmYacSnDQBTb98qMJyZIdR+Jc+5oaqob5luRXRjBYWtKR6vv7z360a23Hl/kIiwK1fA0NGAZ5JYzg4LW6F+zmv+8DxrelNpymiTVGPF8rNrNynPQ/G9VCZfc03BJHbGlCyAjPSS10OHD4iBrKY6yyVuFc5Vi1Sj1Jci5UTo6S8HSMRKYksI6F0mC/Tz+kke7QAwlcRwcTB84HE/FZhu6IfVh0DsbiJI60t8DBIPGKKhEZ1bYpZu4XCEw6UE0ejUfXu8dN4dt7Hp7MhlRU4e67BtOAvgRMSvba8ucQ4eN1dWBC+jqjzkdynFkiKh/IDitS2Fuk0FnrRmgihNr+Rhige6RoDe31cr/fVQeiKkvRjVmQzWDXcWk8LISqUsy7rsfLoJ3+Oes2s9DtxDEBWt8GK3CNe7VDYwbPqdhZ+aeGhlftE14ijMCTxEiEmqYtmgiuepIZV/tTDR45652vAlR2j6xqpHFRnIMoXPd0QaLwM=
    # GITHUB_TOKEN
    - secure: MtrQAeM6f1G5MBC3k//l01c/qeMdUw2D1WmYpjkVnzdaXWSdWdAqwHe/XN1W6ad5hJr8c3CdU5BXUtXQ3fEPz+XmOJzoVut5tbPGCpzgV8XRZMobjlHbPfm+o+4n5JImFmoaICNGhIMB7/Ks5f1IBcWIoVYlLX4d36O6aVUpktLkfQcAvKTf72MVyy0vP0qMI9y9t+pr+usUPuNF6C5g8t8NyYzGNYQn8Xxd+TSmfdam5nMAZ2bn3hgRBrxo4+KsLEgYEav8tEJD7Qm+96bGJoLg+S3XCJT8B2KE9G4vUbwoUUhzysXqx4A6dXaCCS2qY2W0g9ara0JkRa2EtO72oq5yjAC1+lHUHO7J7XAkuXmnWuTkRVfso3ASYtE5WbhKZdeSd29qzJu7Tdali574C61Ne20HICH6jWjt5Tpq6HIP1rt6ebUbZBvIccS5IT3psA8xIqH0hHvSZMQ8yypeZcWLPlvt2QL8GxMC0uG4CTRWS0Y+cb5TifEIVNSPjkhzN+lBSk7wvVG3Z82Ebv4jcxY9VGdD1qViL4GUDEUc4FfpnU1d4tOhMcVosfQ5VoSthgYkAbZ6hWy8rLrvUA6uoSd7Xd4d7ua/tTpUlgXbUeqrdb/OBy/cTVQUB86oNKSuJ6MzbP1phc8K0XNgKshSdGV0hIy0BYwJQXehY/OPz9Q=
    - PR_TAG: $(if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then echo "-$TRAVIS_PULL_REQUEST"; else echo ""; fi)
    - PACKAGE_REGISTRY_HOST: $(if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then echo "ghcr.io"; else echo ""; fi)
    - PACKAGE_REGISTRY: $(if [ "$PACKAGE_REGISTRY_HOST" != "" ]; then echo "${PACKAGE_REGISTRY_HOST}/wordpress/wpdev-docker-images"; else echo "wordpressdevelop"; fi)

before_script:
  - |
    if [ "${TRAVIS_PULL_REQUEST}" = "false" ]; then
      echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    else
      echo "$GITHUB_TOKEN" | docker login ghcr.io -u "$GITHUB_USERNAME" --password-stdin
    fi

jobs:
  include:
    - stage: "Build PHP images"
%%BUILD_PHP_IMAGES%%
    - stage: "Build PHPUnit images"
%%BUILD_PHPUNIT_IMAGES%%
    - stage: "Build CLI images"
%%BUILD_CLI_IMAGES%%
