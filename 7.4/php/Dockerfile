FROM php:7.4-rc-fpm

WORKDIR /var/www

##########################################################################
#
# WARNING: This file was generated by update.php. Do not edit it directly.
#
#

ENV COMPOSER_ALLOW_SUPERUSER 1
ENV COMPOSER_HOME /tmp

# install the PHP extensions we need
RUN set -ex; \
	\
	apt-get update; \
	\
	apt-get install -y --no-install-recommends libjpeg-dev libpng-dev libzip-dev libmemcached-dev; \
	\
	docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr; \
	\
	docker-php-ext-install gd opcache mysqli zip; \
	\
	pecl install xdebug-2.8.0beta1; \
	pecl install memcached-3.1.3; \
	\
	curl --silent --fail --location --retry 3 --output /tmp/installer.sig --url https://composer.github.io/installer.sig; \
	curl --silent --fail --location --retry 3 --output /tmp/installer.php --url https://getcomposer.org/installer; \
	php -r " \
		\$signature = file_get_contents( '/tmp/installer.sig' ); \
		\$hash = hash('sha384', file_get_contents('/tmp/installer.php')); \
		if (!hash_equals(\$signature, \$hash)) { \
			unlink('/tmp/installer.php'); \
			echo 'Integrity check failed, installer is either corrupt or worse.' . PHP_EOL; \
			exit(1); \
		}"; \
	php /tmp/installer.php --no-ansi --install-dir=/usr/bin --filename=composer; \
	composer --ansi --version --no-interaction; \
	rm -f /tmp/installer.php /tmp/installer.sig;

COPY entrypoint.sh /entrypoint.sh

RUN chmod +x /entrypoint.sh

ENTRYPOINT [ "/entrypoint.sh" ]

CMD [ "php-fpm" ]
